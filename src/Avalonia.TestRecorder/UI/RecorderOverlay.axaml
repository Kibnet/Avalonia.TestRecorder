<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="Avalonia.TestRecorder.UI.RecorderOverlay"
             BorderThickness="0"
             Name="OverlayControl">
    <UserControl.Styles>
        <Style Selector="UserControl">
            <Setter Property="Background" Value="{DynamicResource RecorderOverlayBackground}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource RecorderOverlayBorder}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="CornerRadius" Value="0,0,6,6"/>
        </Style>
        
        <!-- Light Theme (Default) -->
        <Style Selector="UserControl">
            <Style.Resources>
                <SolidColorBrush x:Key="RecorderOverlayBackground">#F0F0F0</SolidColorBrush>
                <SolidColorBrush x:Key="RecorderOverlayBorder">#C0C0C0</SolidColorBrush>
                <SolidColorBrush x:Key="RecorderSeparator">#C0C0C0</SolidColorBrush>
                <SolidColorBrush x:Key="RecorderTextColor">#000000</SolidColorBrush>
                <SolidColorBrush x:Key="RecorderBorderColor">#C0C0C0</SolidColorBrush>
                <SolidColorBrush x:Key="RecorderClearIcon">#95A5A6</SolidColorBrush>
                <SolidColorBrush x:Key="RecorderCloseIcon">#95A5A6</SolidColorBrush>
                <SolidColorBrush x:Key="RecorderStatusText">#27AE60</SolidColorBrush> <!-- Green for success -->
                <SolidColorBrush x:Key="RecorderHelpIcon">#5DADE2</SolidColorBrush>
                <SolidColorBrush x:Key="RecorderHelpPopupBackground">#FFFFFF</SolidColorBrush>
                <SolidColorBrush x:Key="RecorderHelpPopupBorder">#C0C0C0</SolidColorBrush>
                <SolidColorBrush x:Key="RecorderHelpShortcutText">#3498DB</SolidColorBrush>
            </Style.Resources>
        </Style>
        
        <!-- Dark Theme -->
        <Style Selector="UserControl.dark-theme">
            <Style.Resources>
                <SolidColorBrush x:Key="RecorderOverlayBackground">#2D2D30</SolidColorBrush>
                <SolidColorBrush x:Key="RecorderOverlayBorder">#3F3F46</SolidColorBrush>
                <SolidColorBrush x:Key="RecorderSeparator">#3F3F46</SolidColorBrush>
                <SolidColorBrush x:Key="RecorderTextColor">#FFFFFF</SolidColorBrush>
                <SolidColorBrush x:Key="RecorderBorderColor">#3F3F46</SolidColorBrush>
                <SolidColorBrush x:Key="RecorderClearIcon">#B0B0B0</SolidColorBrush>
                <SolidColorBrush x:Key="RecorderCloseIcon">#B0B0B0</SolidColorBrush>
                <SolidColorBrush x:Key="RecorderStatusText">#2ECC71</SolidColorBrush> <!-- Light green for dark theme -->
                <SolidColorBrush x:Key="RecorderHelpIcon">#5DADE2</SolidColorBrush>
                <SolidColorBrush x:Key="RecorderHelpPopupBackground">#3C3C3C</SolidColorBrush>
                <SolidColorBrush x:Key="RecorderHelpPopupBorder">#5F5F5F</SolidColorBrush>
                <SolidColorBrush x:Key="RecorderHelpShortcutText">#5DADE2</SolidColorBrush>
            </Style.Resources>
        </Style>
        
        <!-- Status Text Style -->
        <Style Selector="TextBlock.status-text">
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="VerticalAlignment" Value="Stretch"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="Margin" Value="8,0"/>
            <Setter Property="Foreground" Value="{DynamicResource RecorderStatusText}"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="MaxWidth" Value="600"/>
        </Style>
    </UserControl.Styles>
    <Border Padding="0" BorderThickness="0">
        <!-- Add drop shadow effect for floating appearance -->
        <Border.Effect>
            <DropShadowEffect Color="Black" Opacity="0.3" BlurRadius="12" OffsetX="0" OffsetY="4"/>
        </Border.Effect>
        
        <!-- Container for both panels -->
        <Grid>
            <!-- Expanded State (Normal) -->
            <StackPanel Name="ExpandedPanel" Orientation="Horizontal" Spacing="0">
                
                <!-- Minimize Button -->
                <Button Name="MinimizeButton" 
                        Width="30" Height="30" 
                        Padding="4"
                        ToolTip.Tip="Minimize overlay (Ctrl+Shift+M)">
                    <Viewbox Width="20" Height="20">
                        <Canvas Width="24" Height="24">
                            <!-- Minimize Icon -->
                            <Path Fill="{DynamicResource RecorderCloseIcon}" Data="M19,13H5V11H19V13Z"/>
                        </Canvas>
                    </Viewbox>
                </Button>

                <!-- Help Button -->
                <Button Name="HelpButton" 
                        Width="30" Height="30" 
                        Padding="4">
                    <Button.Flyout>
                        <Flyout Placement="Bottom" ShowMode="TransientWithDismissOnPointerMoveAway">
                            <Border Background="{DynamicResource RecorderHelpPopupBackground}" 
                                    BorderBrush="{DynamicResource RecorderHelpPopupBorder}" 
                                    BorderThickness="1" 
                                    CornerRadius="6" 
                                    Padding="12">
                                <StackPanel Spacing="8" MinWidth="280">
                                    <TextBlock Text="Keyboard Shortcuts" 
                                               FontWeight="Bold" 
                                               FontSize="14" 
                                               Foreground="{DynamicResource RecorderTextColor}"/>
                                    
                                    <Border Height="1" Background="{DynamicResource RecorderSeparator}" Margin="0,4"/>
                                    
                                    <!-- Recording Controls -->
                                    <TextBlock Text="Recording Controls" 
                                               FontWeight="SemiBold" 
                                               FontSize="11" 
                                               Foreground="{DynamicResource RecorderTextColor}" 
                                               Margin="0,4,0,2"/>
                                    
                                    <Grid ColumnDefinitions="Auto,*">
                                        <StackPanel Grid.Column="0" Spacing="4">
                                            <TextBlock Text="Ctrl+Shift+R" Foreground="{DynamicResource RecorderHelpShortcutText}" FontFamily="Consolas" FontSize="11"/>
                                            <TextBlock Text="Ctrl+Shift+S" Foreground="{DynamicResource RecorderHelpShortcutText}" FontFamily="Consolas" FontSize="11"/>
                                            <TextBlock Text="Ctrl+Shift+C" Foreground="{DynamicResource RecorderHelpShortcutText}" FontFamily="Consolas" FontSize="11"/>
                                            <TextBlock Text="Ctrl+Shift+M" Foreground="{DynamicResource RecorderHelpShortcutText}" FontFamily="Consolas" FontSize="11"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="1" Spacing="4" Margin="16,0,0,0">
                                            <TextBlock Text="Start/Stop Recording" Foreground="{DynamicResource RecorderTextColor}" FontSize="11"/>
                                            <TextBlock Text="Save Test" Foreground="{DynamicResource RecorderTextColor}" FontSize="11"/>
                                            <TextBlock Text="Clear Steps" Foreground="{DynamicResource RecorderTextColor}" FontSize="11"/>
                                            <TextBlock Text="Minimize/Restore Overlay" Foreground="{DynamicResource RecorderTextColor}" FontSize="11"/>
                                        </StackPanel>
                                    </Grid>
                                    
                                    <Border Height="1" Background="{DynamicResource RecorderSeparator}" Margin="0,4"/>
                                    
                                    <!-- Assertions -->
                                    <TextBlock Text="Assertions (hover over element first)" 
                                               FontWeight="SemiBold" 
                                               FontSize="11" 
                                               Foreground="{DynamicResource RecorderTextColor}" 
                                               Margin="0,4,0,2"/>
                                    
                                    <Grid ColumnDefinitions="Auto,*">
                                        <StackPanel Grid.Column="0" Spacing="4">
                                            <TextBlock Text="Ctrl+Shift+A" Foreground="{DynamicResource RecorderHelpShortcutText}" FontFamily="Consolas" FontSize="11"/>
                                            <TextBlock Text="Ctrl+Shift+T" Foreground="{DynamicResource RecorderHelpShortcutText}" FontFamily="Consolas" FontSize="11"/>
                                            <TextBlock Text="Ctrl+Shift+V" Foreground="{DynamicResource RecorderHelpShortcutText}" FontFamily="Consolas" FontSize="11"/>
                                            <TextBlock Text="Ctrl+Shift+E" Foreground="{DynamicResource RecorderHelpShortcutText}" FontFamily="Consolas" FontSize="11"/>
                                            <TextBlock Text="Ctrl+Shift+K" Foreground="{DynamicResource RecorderHelpShortcutText}" FontFamily="Consolas" FontSize="11"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="1" Spacing="4" Margin="16,0,0,0">
                                            <TextBlock Text="Auto-detect Assertion" Foreground="{DynamicResource RecorderTextColor}" FontSize="11"/>
                                            <TextBlock Text="Assert Text Content" Foreground="{DynamicResource RecorderTextColor}" FontSize="11"/>
                                            <TextBlock Text="Assert Visible" Foreground="{DynamicResource RecorderTextColor}" FontSize="11"/>
                                            <TextBlock Text="Assert Enabled" Foreground="{DynamicResource RecorderTextColor}" FontSize="11"/>
                                            <TextBlock Text="Assert Checked" Foreground="{DynamicResource RecorderTextColor}" FontSize="11"/>
                                        </StackPanel>
                                    </Grid>
                                    
                                    <Border Height="1" Background="{DynamicResource RecorderSeparator}" Margin="0,4"/>
                                    
                                    <!-- Tip -->
                                    <TextBlock Text="Tip: Hover over a control, then press the shortcut to capture an assertion." 
                                               FontStyle="Italic" 
                                               FontSize="10" 
                                               Foreground="{DynamicResource RecorderTextColor}" 
                                               TextWrapping="Wrap"
                                               Opacity="0.7"/>
                                </StackPanel>
                            </Border>
                        </Flyout>
                    </Button.Flyout>
                    <Viewbox Width="20" Height="20">
                        <Canvas Width="24" Height="24">
                            <!-- Question Mark Icon -->
                            <Path Fill="{DynamicResource RecorderHelpIcon}" Data="M11,18H13V16H11V18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z"/>
                        </Canvas>
                    </Viewbox>
                </Button>
                
                <!-- Record/Pause Button -->
                <Button Name="RecordButton" 
                        Width="30" Height="30" 
                        Padding="4"
                        ToolTip.Tip="Record/Pause (Ctrl+Shift+R)">
                    <Viewbox Width="20" Height="20">
                        <Canvas Width="24" Height="24">
                            <!-- Play Icon -->
                            <Path Fill="#27AE60" Name="PlayIcon" Data="M8,5.14V19.14L19,12.14L8,5.14Z"/>
                            <!-- Stop Icon -->
                            <Rectangle Width="14" Height="14" Canvas.Left="5" Canvas.Top="5" Fill="#E74C3C" Name="StopIcon" IsVisible="False"/>
                        </Canvas>
                    </Viewbox>
                </Button>

                <!-- Clear Button -->
                <Button Name="ClearButton" 
                        Width="30" Height="30" 
                        Padding="4"
                        ToolTip.Tip="Clear recorded steps (Ctrl+Shift+C)">
                    <Viewbox Width="20" Height="20">
                        <Canvas Width="24" Height="24">
                            <!-- Trash Icon -->
                            <Path Fill="{DynamicResource RecorderClearIcon}" Data="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"/>
                        </Canvas>
                    </Viewbox>
                </Button>

                <!-- Save Button -->
                <Button Name="SaveButton" 
                        Width="30" Height="30" 
                        Padding="4"
                        ToolTip.Tip="Save test (Ctrl+Shift+S)">
                    <Viewbox Width="20" Height="20">
                        <Canvas Width="24" Height="24">
                            <!-- Save Icon -->
                            <Path Fill="#3498DB" Data="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"/>
                        </Canvas>
                    </Viewbox>
                </Button>

                <!-- Separator -->
                <Border Width="1" Background="{DynamicResource RecorderSeparator}" Margin="4,6"/>

                <!-- Step Counter -->
                <TextBlock Name="StepCounter" 
                          Text="0" 
                          VerticalAlignment="Center" 
                          Foreground="{DynamicResource RecorderTextColor}"
                          FontWeight="SemiBold"
                          FontSize="14"
                          Margin="8,0"/>

                <!-- Status Bar Area - Right aligned -->
                <Panel HorizontalAlignment="Right" 
                       VerticalAlignment="Center"
                       Margin="0,0,8,0">
                    <TextBlock Name="StatusBarText" 
                               Classes="status-text"
                               Text="" />
                </Panel>
            </StackPanel>
            
            <!-- Minimized State -->
            <StackPanel Name="MinimizedPanel" Orientation="Horizontal" Spacing="0" IsVisible="False">
                <!-- Restore Button -->
                <Button Name="RestoreButton" 
                        Width="30" Height="30" 
                        Padding="4"
                        ToolTip.Tip="Restore overlay (Ctrl+Shift+M)">
                    <Viewbox Width="18" Height="18">
                        <Canvas Width="24" Height="24">
                            <!-- Restore Icon -->
                            <Path Fill="{DynamicResource RecorderCloseIcon}" Data="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
                        </Canvas>
                    </Viewbox>
                </Button>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>